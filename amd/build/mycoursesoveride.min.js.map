{"version":3,"sources":["../src/mycoursesoveride.js"],"names":["define","$","Templates","toggleClickHandler","node","click","e","preventDefault","attr","collapseNode","expandNode","find","addClass","removeClass","addAriaToParent","ids","each","index","element","id","substring","trim","tabbableDiv","keydown","which","currentTarget","mousedown","css","mouseup","blur","initToggleNodes","nodename","sortByKeyDesc","array","key1","key2","sort","a","b","x","y","createOngoingNode","ongoingnodes","render","then","html","after","fillOngoingNode","nodes","termnode","i","length","createNode","createPastNode","pastnodes","pterms","divarray","past","console","log","createHeaders","fillPastNode","term","hidden","termnodes","j","when","apply","done","fillCurrentNode","childNodes","childNode","terms","promises","forEach","headerarray","split","push","promise","all","deferred","Deferred","fulfilled","results","resolve","value","init","currentNodes","cterms","pastNodes","ongoingNodes","remove"],"mappings":"AAuBAA,OAAM,0CACF,CACI,QADJ,CAEI,gBAFJ,CADE,CAKF,SACIC,CADJ,CAEIC,CAFJ,CAGE,CACF,aAQA,QAASC,CAAAA,CAAT,CAA4BC,CAA5B,CAA4C,CACxCA,CAAI,CAACC,KAAL,CAAW,SAASC,CAAT,CAAY,CAEnBA,CAAC,CAACC,cAAF,GAGA,GAAkC,CAA9B,EAAAH,CAAI,CAACI,IAAL,CAAU,eAAV,CAAJ,CAAqC,CAEjCC,CAAY,CAACL,CAAD,CAEf,CAJD,IAIO,IAAkC,CAA9B,EAAAA,CAAI,CAACI,IAAL,CAAU,eAAV,CAAJ,CAAqC,CAExCE,CAAU,CAACN,CAAD,CACb,CACJ,CAbD,EAgBAH,CAAC,CAAC,0CAAD,CAAD,CAA4CI,KAA5C,CAAkD,UAAW,CACzDI,CAAY,CAACL,CAAD,CACf,CAFD,CAGH,CAOD,QAASK,CAAAA,CAAT,CAAsBL,CAAtB,CAA4B,CAGxBH,CAAC,CAAC,sCAAD,CAAD,CAAwCO,IAAxC,CAA6C,aAA7C,CAA4D,GAA5D,EAEAJ,CAAI,CAACI,IAAL,CAAU,eAAV,CAA2B,GAA3B,EAEAJ,CAAI,CAACI,IAAL,CAAU,eAAV,CAA2B,GAA3B,EAEAJ,CAAI,CAACO,IAAL,CAAU,gBAAV,EAA4BC,QAA5B,CAAqC,gBAArC,EACAR,CAAI,CAACO,IAAL,CAAU,iBAAV,EAA6BE,WAA7B,CAAyC,eAAzC,CACF,CAOF,QAASH,CAAAA,CAAT,CAAoBN,CAApB,CAA0B,CAEtBH,CAAC,CAAC,sCAAD,CAAD,CAAwCO,IAAxC,CAA6C,aAA7C,CAA4D,GAA5D,EAEAJ,CAAI,CAACI,IAAL,CAAU,eAAV,CAA2B,GAA3B,EAEAJ,CAAI,CAACI,IAAL,CAAU,eAAV,CAA2B,GAA3B,EAEAJ,CAAI,CAACO,IAAL,CAAU,iBAAV,EAA6BC,QAA7B,CAAsC,eAAtC,EACAR,CAAI,CAACO,IAAL,CAAU,gBAAV,EAA4BE,WAA5B,CAAwC,gBAAxC,CACH,CAOD,QAASC,CAAAA,CAAT,CAAyBV,CAAzB,CAAyC,CAGrC,GAAIW,CAAAA,CAAG,CAAG,EAAV,CAEAd,CAAC,CAAC,sCAAD,CAAD,CAAwCe,IAAxC,CAA6C,SAASC,CAAT,CAAgBC,CAAhB,CAAyB,CAElE,GAAIC,CAAAA,CAAE,CAAGlB,CAAC,CAACiB,CAAD,CAAD,CAAWV,IAAX,CAAgB,UAAhB,CAAT,CAGA,GAA4B,YAAxB,GAAAW,CAAE,CAACC,SAAH,CAAa,CAAb,CAAgB,EAAhB,CAAJ,CAA0C,CACtCD,CAAE,CAAG,uBAAyBA,CACjC,CAGDlB,CAAC,CAACiB,CAAD,CAAD,CAAWV,IAAX,CAAgB,IAAhB,CAAsBW,CAAtB,EAEAJ,CAAG,CAAGA,CAAG,CAAGI,CAAN,CAAW,GACpB,CAbD,EAgBA,GAAY,EAAR,EAAAJ,CAAJ,CAAgB,CACZX,CAAI,CAACI,IAAL,CAAU,eAAV,CAA2BO,CAAG,CAACM,IAAJ,EAA3B,CACH,CAID,GAAkC,CAA9B,EAAAjB,CAAI,CAACI,IAAL,CAAU,eAAV,CAAJ,CAAqC,CAEjCJ,CAAI,CAACI,IAAL,CAAU,eAAV,CAA2B,GAA3B,CAGH,CALD,IAKO,IAAkC,CAA9B,EAAAJ,CAAI,CAACI,IAAL,CAAU,eAAV,CAAJ,CAAqC,CAExCJ,CAAI,CAACI,IAAL,CAAU,eAAV,CAA2B,GAA3B,CACH,CACJ,CAMD,QAASc,CAAAA,CAAT,CAAqBlB,CAArB,CAA2B,CAEvBA,CAAI,CAACI,IAAL,CAAU,UAAV,CAAsB,GAAtB,EAGAJ,CAAI,CAACmB,OAAL,CAAa,SAASjB,CAAT,CAAY,CACrB,GAAgB,EAAZ,GAAAA,CAAC,CAACkB,KAAN,CAAoB,CAChBlB,CAAC,CAACmB,aAAF,CAAgBpB,KAAhB,EACH,CACJ,CAJD,EAQAD,CAAI,CAACsB,SAAL,CAAe,UAAW,CACtBtB,CAAI,CAACuB,GAAL,CAAS,SAAT,CAAoB,MAApB,CACH,CAFD,EAGAvB,CAAI,CAACwB,OAAL,CAAa,UAAW,CACpBxB,CAAI,CAACuB,GAAL,CAAS,SAAT,CAAoB,EAApB,EACAvB,CAAI,CAACyB,IAAL,EACH,CAHD,CAIH,CAMD,QAASC,CAAAA,CAAT,CAAyBC,CAAzB,CAAmC,CAE/B,GAAI3B,CAAAA,CAAI,CAAGH,CAAC,CAAC,+BAAgC8B,CAAhC,CAA2C,KAA5C,CAAZ,CAGA5B,CAAkB,CAACC,CAAD,CAAO2B,CAAP,CAAlB,CAGAjB,CAAe,CAACV,CAAD,CAAO2B,CAAP,CAAf,CAEAT,CAAW,CAAClB,CAAD,CACd,CAQD,QAAS4B,CAAAA,CAAT,CAAuBC,CAAvB,CAA8BC,CAA9B,CAAoCC,CAApC,CAA0C,CACtC,MAAOF,CAAAA,CAAK,CAACG,IAAN,CAAW,SAAUC,CAAV,CAAaC,CAAb,CAAgB,CAE9B,GAAGD,CAAC,CAACH,CAAD,CAAD,EAASI,CAAC,CAACJ,CAAD,CAAb,CAAoB,IACZK,CAAAA,CAAC,CAAGF,CAAC,CAACF,CAAD,CADO,CAEZK,CAAC,CAAGF,CAAC,CAACH,CAAD,CAFO,CAGhB,MAASI,CAAAA,CAAC,CAAGC,CAAL,CAAU,CAAC,CAAX,CAAiBD,CAAC,CAAGC,CAAL,CAAU,CAAV,CAAc,CACzC,CAJD,IAIK,IACGD,CAAAA,CAAC,CAAGF,CAAC,CAACH,CAAD,CADR,CAEGM,CAAC,CAAGF,CAAC,CAACJ,CAAD,CAFR,CAGD,MAASK,CAAAA,CAAC,CAAGC,CAAL,CAAU,CAAC,CAAX,CAAiBD,CAAC,CAAGC,CAAL,CAAU,CAAV,CAAc,CACzC,CACJ,CAXM,CAYV,CAOD,QAASR,CAAAA,CAAT,CAAuBC,CAAvB,CAA8BC,CAA9B,CAAoC,CAChC,MAAOD,CAAAA,CAAK,CAACG,IAAN,CAAW,SAAUC,CAAV,CAAaC,CAAb,CAAgB,IAC1BC,CAAAA,CAAC,CAAGF,CAAC,CAACH,CAAD,CADqB,CAE1BM,CAAC,CAAGF,CAAC,CAACJ,CAAD,CAFqB,CAG9B,MAASK,CAAAA,CAAC,CAAGC,CAAL,CAAU,CAAC,CAAX,CAAiBD,CAAC,CAAGC,CAAL,CAAU,CAAV,CAAc,CACzC,CAJM,CAKV,CAOD,QAASC,CAAAA,CAAT,CAA2BrC,CAA3B,CAAgCsC,CAAhC,CAA8C,CAU3CxC,CAAS,CAACyC,MAAV,CAAiB,wCAAjB,CARgB,KACC,kBADD,YAEQ,WAFR,MAGE,iBAHF,iCAMQ,CANR,CAQhB,EAAqEC,IAArE,CAA0E,SAASC,CAAT,CAAe,CACpFzC,CAAI,CAAC0C,KAAL,CAAWD,CAAX,EAEAE,CAAe,CAACL,CAAD,CAClB,CAJF,CAKF,CAMD,QAASK,CAAAA,CAAT,CAAyBC,CAAzB,CAAgC,CAI5B,OAFIC,CAAAA,CAAQ,CAAGhD,CAAC,CAAC,iDAAD,CAEhB,CAAQiD,CAAC,CAAC,CAAV,CAAaA,CAAC,CAACF,CAAK,CAACG,MAArB,CAA6BD,CAAC,EAA9B,CAAiC,CAE7BF,CAAK,CAACE,CAAD,CAAL,YAAuB,CAAvB,CACAE,CAAU,CAACH,CAAQ,CAAC,CAAD,CAAT,CAAcD,CAAK,CAACE,CAAD,CAAnB,CACb,CACJ,CAOD,QAASG,CAAAA,CAAT,CAAwBjD,CAAxB,CAA6BkD,CAA7B,CAAwCC,CAAxC,CAAgD,IAIxCC,CAAAA,CAAQ,CAAG,EAJ6B,CAK5CA,CAAQ,IAAR,CAAgB,eAAhB,CACAA,CAAQ,aAAR,CAAyB,CAAzB,CACAA,CAAQ,WAAR,CAAuB,CAAvB,CACAA,CAAQ,YAAR,CAAwB,CAAxB,CACAA,CAAQ,KAAR,CAAiB,CAAjB,CACAA,CAAQ,SAAR,CAAqB,CAArB,CACAA,CAAQ,SAAR,CAAqB,CAArB,CACAA,CAAQ,UAAR,CAAsB,CAAtB,CACAA,CAAQ,SAAR,CAAqB,CAArB,CACAA,CAAQ,OAAR,CAAmB,CAAnB,CACAA,CAAQ,cAAR,CAA0B,CAA1B,CACAA,CAAQ,OAAR,CAAmB,WAAnB,CACAA,CAAQ,KAAR,CAAiB,cAAjB,CACAA,CAAQ,KAAR,CAhBU,CACA,CAAC,IAAM,YAAP,CAAoB,IAAM,EAA1B,CAA6B,UAAY,QAAzC,CADA,CAgBV,CAEDtD,CAAS,CAACyC,MAAV,CAAiB,wCAAjB,CAA2Da,CAA3D,EAAqEZ,IAArE,CAA0E,SAASC,CAAT,CAAe,CACpFzC,CAAI,CAAC0C,KAAL,CAAWD,CAAX,EAEA,GAAIY,CAAAA,CAAI,CAAGxD,CAAC,CAAC,8CAAD,CAAZ,CAEAyD,OAAO,CAACC,GAAR,CAAY,QAAZ,EACAD,OAAO,CAACC,GAAR,CAAYL,CAAZ,EACAM,CAAa,CAACL,CAAD,CAAQE,CAAR,IAAb,CAAgCb,IAAhC,CAAqC,UAAU,CAE3Cc,OAAO,CAACC,GAAR,CAAY,SAAZ,EACAD,OAAO,CAACC,GAAR,CAAYL,CAAZ,EAEAO,CAAY,CAACP,CAAD,CACf,CAND,CAOH,CAdF,CAeF,CAMD,QAASO,CAAAA,CAAT,CAAsBb,CAAtB,CAA6B,CAEzB,GAAIc,CAAAA,CAAI,CAAE,EAAV,CAEAJ,OAAO,CAACC,GAAR,CAAY,OAAZ,EACAD,OAAO,CAACC,GAAR,CAAYX,CAAZ,EACA,IAAI,GAAIE,CAAAA,CAAC,CAAC,CAAV,CAAaA,CAAC,CAACF,CAAK,CAACG,MAArB,CAA6BD,CAAC,EAA9B,CAAiC,CAG7BF,CAAK,CAACE,CAAD,CAAL,YAAuB,CAAvB,CACAF,CAAK,CAACE,CAAD,CAAL,CAASO,IAAT,IACAT,CAAK,CAACE,CAAD,CAAL,CAASa,MAAT,CAAgB,CAAhB,CAEA,GAAGD,CAAI,EAAId,CAAK,CAACE,CAAD,CAAL,CAASY,IAApB,CAA0B,CACtBA,CAAI,CAAGd,CAAK,CAACE,CAAD,CAAL,CAASY,IACnB,CAID,OAFIE,CAAAA,CAAS,CAAG/D,CAAC,CAAC,+BAA8B6D,CAA9B,CAAmC,KAApC,CAEjB,CAAQG,CAAC,CAAC,CAAV,CACQzD,CADR,CAAayD,CAAC,CAACD,CAAS,CAACb,MAAzB,CAAgCc,CAAC,EAAjC,CAAoC,CAC5BzD,CAD4B,CACrBP,CAAC,CAAC+D,CAAS,CAACC,CAAD,CAAV,CAAD,CAAgBzD,IAAhB,CAAqB,WAArB,CADqB,CAEhC,GAAa,MAAR,EAAAA,CAAI,EAAc,IAAAA,CAAvB,CAAuC,CACnC,GAAIyC,CAAAA,CAAQ,CAAGe,CAAS,CAACC,CAAD,CAC3B,CACJ,CAEDP,OAAO,CAACC,GAAR,CAAYV,CAAZ,EACAG,CAAU,CAACH,CAAD,CAAWD,CAAK,CAACE,CAAD,CAAhB,CACb,CAEDjD,CAAC,CAACiE,IAAF,CAAOC,KAAP,CAAalE,CAAb,CAAgB+C,CAAhB,EAAuBoB,IAAvB,CAA4B,UAAW,CAGnCtC,CAAe,CAAC,eAAD,CAClB,CAJD,CAKH,CAOD,QAASuC,CAAAA,CAAT,CAAyBC,CAAzB,CAAqC,CAKjC,OAFIR,CAAAA,CAAI,CAAE,EAEV,CAAQZ,CAAC,CAAC,CAAV,CAAaA,CAAC,CAACoB,CAAU,CAACnB,MAA1B,CAAkCD,CAAC,EAAnC,CAAsC,CAElC,GAAGY,CAAI,EAAIQ,CAAU,CAACpB,CAAD,CAAV,CAAcY,IAAzB,CAA+B,CAC3BA,CAAI,CAAGQ,CAAU,CAACpB,CAAD,CAAV,CAAcY,IACxB,CAGD,OAFIE,CAAAA,CAAS,CAAG/D,CAAC,CAAC,+BAA8B6D,CAA9B,CAAmC,KAApC,CAEjB,CAAQG,CAAC,CAAC,CAAV,CACQzD,CADR,CAAayD,CAAC,CAACD,CAAS,CAACb,MAAzB,CAAgCc,CAAC,EAAjC,CAAoC,CAC5BzD,CAD4B,CACrBP,CAAC,CAAC+D,CAAS,CAACC,CAAD,CAAV,CAAD,CAAgBzD,IAAhB,CAAqB,WAArB,CADqB,CAEhC,GAAY,OAAR,EAAAA,CAAJ,CAAqB,CACjB,GAAIyC,CAAAA,CAAQ,CAAGe,CAAS,CAACC,CAAD,CAC3B,CACJ,CACDb,CAAU,CAACH,CAAD,CAAWqB,CAAU,CAACpB,CAAD,CAArB,CACb,CACJ,CAMD,QAASE,CAAAA,CAAT,CAAoBhD,CAApB,CAAyBmE,CAAzB,CAAoC,CAChCrE,CAAS,CAACyC,MAAV,CAAiB,wCAAjB,CAA2D4B,CAA3D,EAAsE3B,IAAtE,CAA2E,SAASC,CAAT,CAAe,CACtF5C,CAAC,CAACG,CAAD,CAAD,CAAQ0C,KAAR,CAAcD,CAAd,CACH,CAFD,CAGH,CAMD,QAASe,CAAAA,CAAT,CAAuBY,CAAvB,CAA6BpE,CAA7B,CAAkCqD,CAAlC,CAAwC,CAEpCC,OAAO,CAACC,GAAR,CAAY,OAAZ,EAuBAD,OAAO,CAACC,GAAR,CAAY,OAAZ,EACAD,OAAO,CAACC,GAAR,CAAYa,CAAZ,EAEA,GAAIC,CAAAA,CAAQ,CAAG,EAAf,CAGAD,CAAK,CAACE,OAAN,CAAc,SAASZ,CAAT,CAAe,CACzB,GAAIa,CAAAA,CAAW,CAAG,QACI,MADJ,MAEEb,CAFF,YAGQ,WAHR,YAIQ,CAJR,CAAlB,CAMAJ,OAAO,CAACC,GAAR,CAAY,QAAZ,EACAD,OAAO,CAACC,GAAR,CAAYG,CAAZ,EACA,GAAIc,CAAAA,CAAK,CAAGd,CAAI,CAACc,KAAL,CAAW,GAAX,CAAZ,CACA,GAAa,eAAV,EAAAA,CAAK,CAAC,CAAD,CAAR,CAA6B,CACzBD,CAAW,OAAX,CAAsB,MACzB,CAFD,IAEK,CACDA,CAAW,CAACC,CAAK,CAAC,CAAD,CAAN,CAAX,CAAsB,MACzB,CAED,GAAGnB,CAAH,CAAQ,CACJkB,CAAW,KAAX,CAAoB,MAApB,CACAA,CAAW,OAAX,CAAsB,CAAtB,CACAA,CAAW,WAAX,CAA0B,CAC7B,CAEDF,CAAQ,CAACI,IAAT,CAAc,UAAW,CACrB,MAAO3E,CAAAA,CAAS,CAACyC,MAAV,CAAiB,wCAAjB,CAA2DgC,CAA3D,EAAwE/B,IAAxE,CAA6E,SAASC,CAAT,CAAe,CAC/FzC,CAAI,CAAC0C,KAAL,CAAWD,CAAX,CACH,CAFM,EAEJiC,OAFI,EAGV,CAJD,CAKH,CA3BD,EA6BApB,OAAO,CAACC,GAAR,CAAY,OAAZ,EACA,MAAO1D,CAAAA,CAAC,CAACiE,IAAF,CA1DG,QAANa,CAAAA,GAAM,CAAS9C,CAAT,CAAe,IACjB+C,CAAAA,CAAQ,CAAG/E,CAAC,CAACgF,QAAF,EADM,CAEjBC,CAAS,CAAG,CAFK,CAEF/B,CAAM,CAAGlB,CAAK,CAACkB,MAFb,CAGjBgC,CAAO,CAAG,EAHO,CAKrB,GAAe,CAAX,GAAAhC,CAAJ,CAAkB,CACd6B,CAAQ,CAACI,OAAT,CAAiBD,CAAjB,CACH,CAFD,IAEO,CACHlD,CAAK,CAACyC,OAAN,CAAc,SAASI,CAAT,CAAkB5B,CAAlB,CAAoB,CAC9BjD,CAAC,CAACiE,IAAF,CAAOY,CAAO,EAAd,EAAkBlC,IAAlB,CAAuB,SAASyC,CAAT,CAAgB,CACnCF,CAAO,CAACjC,CAAD,CAAP,CAAamC,CAAb,CACAH,CAAS,GACT,GAAGA,CAAS,GAAK/B,CAAjB,CAAwB,CACpB6B,CAAQ,CAACI,OAAT,CAAiBD,CAAjB,CACH,CACJ,CAND,CAOH,CARD,CASH,CAED,MAAOH,CAAAA,CAAQ,CAACF,OAAT,EACV,CAsCa,CAAIL,CAAJ,CAAP,EAAsB7B,IAAtB,CAA2B,SAASuC,CAAT,CAAkB,CAChD,MAAOA,CAAAA,CACV,CAFM,CAGV,CAED,MAAO,CACHG,IAAI,CAAE,cAASC,CAAT,CAAsBC,CAAtB,CAA8BC,CAA9B,CAAyClC,CAAzC,CAAiDmC,CAAjD,CAA+D,CAEjE,GAAI1C,CAAAA,CAAK,CAAG/C,CAAC,CAAC,iDAAD,CAAb,CACA+C,CAAK,CAAC2C,MAAN,GAEA,GAAIvF,CAAAA,CAAI,CAAGH,CAAC,CAAC,0CAAD,CAAZ,CAEAyD,OAAO,CAACC,GAAR,CAAY,QAAZ,EACAD,OAAO,CAACC,GAAR,CAAY8B,CAAZ,EAEA,GAAqB,CAAlB,CAAAA,CAAS,CAACtC,MAAb,CAAuB,CACnBE,CAAc,CAACjD,CAAD,CAAO4B,CAAa,CAACyD,CAAD,CAAW,MAAX,CAAkB,MAAlB,CAApB,CAA8ClC,CAA9C,CACjB,CAEDK,CAAa,CAAC4B,CAAD,CAAQpF,CAAR,IAAb,CAAiCwC,IAAjC,CAAsC,UAAU,CAC5CyB,CAAe,CAACrC,CAAa,CAACuD,CAAD,CAAe,MAAf,CAAsB,MAAtB,CAAd,CAClB,CAFD,EAIA,GAAwB,CAArB,CAAAG,CAAY,CAACvC,MAAhB,CAA0B,CACtBV,CAAiB,CAACrC,CAAD,CAAO4B,CAAa,CAAC0D,CAAD,CAAc,MAAd,CAApB,CACpB,CACJ,CAtBE,CAwBV,CA7bK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Local plugin \"Boost navigation fumbling\" - JS code for collapsing nav drawer nodes\n *\n * @package    local_boostnavigation\n * @copyright  2017 Kathrin Osswald, Ulm University <kathrin.osswald@uni-ulm.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n    [\n        'jquery',\n        'core/templates'\n    ],\n    function(\n        $,\n        Templates\n    ) {\n    \"use strict\";\n\n\n    /**\n     * Click handler to toggle the given nav node.\n     * @param {Object} node The nav node which should be toggled.\n     * @param {string} nodename The nav node's nodename.\n     */\n    function toggleClickHandler(node, nodename) {\n        node.click(function(e) {\n            // Prevent that the browser opens the node's default action link (if existing).\n            e.preventDefault();\n\n            // If the parent node is currently expanded.\n            if (node.attr('data-collapse') == 0) {\n                // Collapse the node.\n                collapseNode(node);\n                // If the parent node is currently collapsed.\n            } else if (node.attr('data-collapse') == 1) {\n                // Expand the node.\n                expandNode(node);\n            }\n        });\n\n        //if parent mycourses is changed past courses need to reflect those changes\n        $('.list-group-item[data-key=\"mycourses\"]').click(function() {\n            collapseNode(node);\n        });\n    }\n\n    /**\n     * Helper function to collapse the given nav node.\n     * @param {Object} node The nav node which should be toggled.\n     * @param {string} nodename The nav node's nodename.\n     */\n    function collapseNode(node) {\n\n        // Set the hidden attribute to true for all elements which have the nodename as their data-parent-key attribute.\n        $('.list-group-item[data-past=\"true\"]').attr(\"data-hidden\", \"1\");\n        // Change the collapse attribute of the node itself to true.\n        node.attr(\"data-collapse\", \"1\");\n        // Change the aria-expanded attribute of the node itself to false.\n        node.attr(\"aria-expanded\", \"0\");\n        //change arrow\n        node.find(\".fa-caret-down\").addClass(\"fa-caret-right\");\n        node.find(\".fa-caret-right\").removeClass(\"fa-caret-down\");\n     }\n\n    /**\n     * Helper function to expand the given nav node.\n     * @param {Object} node The nav node which should be toggled.\n     * @param {string} nodename The nav node's nodename.\n     */\n    function expandNode(node) {\n        // Set the hidden attribute to false for all elements which have the nodename as their data-parent-key attribute.\n        $('.list-group-item[data-past=\"true\"]').attr(\"data-hidden\", \"0\");\n        // Change the collapse attribute of the node itself to false.\n        node.attr(\"data-collapse\", \"0\");\n        // Change the aria-expanded attribute of the node itself to true.\n        node.attr(\"aria-expanded\", \"1\");\n        //change arrow\n        node.find(\".fa-caret-right\").addClass(\"fa-caret-down\");\n        node.find(\".fa-caret-down\").removeClass(\"fa-caret-right\");\n    }\n\n    /**\n     * Add aria-attributes to a parent node.\n     * @param {Object} node The nav node which should get the aria-attributes.\n     * @param {string} nodename The nav node's nodename.\n     */\n    function addAriaToParent(node, nodename) {\n        // Add ids to the child nodes for referencing in aria-controls.\n        // Initialize string variable to remember the child node ids.\n        var ids = '';\n        // Get the elements which have the nodename as their data-parent-key attribute.\n        $('.list-group-item[data-past=\"true\"]').each(function(index, element) {\n            // Get its data-key attribute (which should be unique) to be used as id attribute.\n            var id = $(element).attr('data-key');\n\n            // Prefix the id attribute if it wasn't built by us (or by our companion plugin local_boostcoc).\n            if (id.substring(0, 10) !== 'localboost') {\n                id = 'localboostnavigation' + id;\n            }\n\n            // Set the id attribute.\n            $(element).attr('id', id);\n            // Remember the id attribute for later use.\n            ids = ids + id + ' ';\n        });\n\n        // Add aria-controls attribute if we have ids to reference.\n        if (ids !== '') {\n            node.attr('aria-controls', ids.trim());\n        }\n\n        // Add aria-expanded attribute.\n        // If the parent node is currently expanded.\n        if (node.attr('data-collapse') == 0) {\n            // Set the aria-expanded attribute of the node itself to false.\n            node.attr('aria-expanded', '1');\n\n            // If the parent node is currently collapsed.\n        } else if (node.attr('data-collapse') == 1) {\n            // Set the aria-expanded attribute of the node itself to true.\n            node.attr('aria-expanded', '0');\n        }\n    }\n\n    /**\n     * Add accessibility to a div node which doesn't behave like an a node.\n     * @param {Object} node The nav node which should be made tabbable.\n     */\n    function tabbableDiv(node) {\n        // Add tabindex attribute so that it will be respected by the browser when the user tabs through the page's elements.\n        node.attr('tabindex', '0');\n\n        // Also call the click handler when the user presses the Enter button.\n        node.keydown(function(e) {\n            if (e.which === 13) {\n                e.currentTarget.click();\n            }\n        });\n\n        // As we added a tabindex attribute, the element gets an element focus outline as soon as it's clicked, too.\n        // Try to prevent this hereby.\n        node.mousedown(function() {\n            node.css('outline', 'none');\n        });\n        node.mouseup(function() {\n            node.css('outline', '');\n            node.blur();\n        });\n    }\n\n    /**\n     * Init function of this AMD module which initializes the click handlers.\n     * @param {string} nodename The nav node's nodename.\n     */\n    function initToggleNodes(nodename) {\n        // Search node to be collapsible.\n        var node = $('.list-group-item[data-key=\"' + nodename + '\"]');\n\n        // Add a click handler to this node.\n        toggleClickHandler(node, nodename);\n\n        // Add aria-attributes to this node.\n        addAriaToParent(node, nodename);\n\n        tabbableDiv(node);\n    }\n\n    /**\n     *\n     * @param {object array} array of mycourses nodes\n     * @param {key1} attribute to sort by\n     * @param {key2} attribute to sort by\n     */\n    function sortByKeyDesc(array, key1, key2) {\n        return array.sort(function (a, b) {\n\n            if(a[key1]==b[key1]){\n                var x = a[key2];\n                var y = b[key2];\n                return ((x > y) ? -1 : ((x < y) ? 1 : 0));\n            }else{\n                var x = a[key1];\n                var y = b[key1];\n                return ((x > y) ? -1 : ((x < y) ? 1 : 0));\n            }\n        });\n    }\n\n    /**\n     *\n     * @param {object array} array of mycourses nodes\n     * @param {key1} attribute to sort by\n     */\n    function sortByKeyDesc(array, key1) {\n        return array.sort(function (a, b) {\n            var x = a[key1];\n            var y = b[key1];\n            return ((x > y) ? -1 : ((x < y) ? 1 : 0));\n        });\n    }\n\n     /**\n     * Create a past course drop down section in mycourses\n     * @param {object} node of mycourses\n     * @param {array} pastnodes array of objects containing all nodes needing to be placed in past courses\n     */\n    function createOngoingNode(node,ongoingnodes) {\n\n        var divarray = {};\n        divarray['key']='mycoursesongoing';\n        divarray['parent_key']=\"mycourses\";\n        divarray['text']=\"Ongoing courses\";\n        divarray[\"ongoing\"]=true;\n        divarray[\"header\"]=true;\n        divarray['get_indent']=0;\n\n       Templates.render('local_boostnavigation/mycoursesoveride', divarray).then(function(html) {\n            node.after(html);\n            //add in nodes under label\n            fillOngoingNode(ongoingnodes);\n        });\n    }\n\n     /**\n     * Fill nodes into mycoursespast\n     * @param {array} nodes Array of past nodes\n     */\n    function fillOngoingNode(nodes) {\n\n        var termnode = $('.list-group-item[data-key=\"mycoursesongoing\"]');\n\n        for(var i=0; i<nodes.length; i++){\n            //used for fomating the new section\n            nodes[i]['get_indent']=0;\n            createNode(termnode[0], nodes[i]);\n        }\n    }\n\n    /**\n     * Create a past course drop down section in mycourses\n     * @param {object} node of mycourses\n     * @param {array} pastnodes array of objects containing all nodes needing to be placed in past courses\n     */\n    function createPastNode(node,pastnodes, pterms) {\n\n        var icon =[];\n        icon.push({'pix':'i/moremenu','alt':\"\",'component':\"moodle\"});\n        var divarray = {};\n        divarray['key']='mycoursespast';\n        divarray['isexpandable']=1;\n        divarray['get_indent']=1;\n        divarray['showdivider']=0;\n        divarray['type']=0;\n        divarray['nodetype']=1;\n        divarray['collapse']=1;\n        divarray['forceopen']=1;\n        divarray['isactive']=0;\n        divarray['hidden']=0;\n        divarray['preceedwithhr']=0;\n        divarray['parent']=\"mycourses\";\n        divarray['text']=\"Past courses\";\n        divarray[\"icon\"]=icon;\n\n       Templates.render('local_boostnavigation/mycoursesoveride', divarray).then(function(html) {\n            node.after(html);\n            //add term header\n            var past = $('.list-group-item[data-key=\"mycoursespast\"]');\n\n            console.log(\"NODES0\");\n            console.log(pastnodes);\n            createHeaders(pterms,past,true).then(function(){\n\n                console.log(\"NODES0c\");\n                console.log(pastnodes);\n                //add in nodes under label\n                fillPastNode(pastnodes);\n            });\n        });\n    }\n\n     /**\n     * Fill nodes into mycoursespast\n     * @param {array} nodes Array of past nodes\n     */\n    function fillPastNode(nodes) {\n\n        var term =\"\";\n\n        console.log(\"NODES\");\n        console.log(nodes);\n        for(var i=0; i<nodes.length; i++){\n\n            //used for fomating the new section\n            nodes[i]['get_indent']=1;\n            nodes[i].past=true;\n            nodes[i].hidden=1;\n\n            if(term != nodes[i].term ){\n                term = nodes[i].term;\n            }\n\n            var termnodes = $('.list-group-item[data-key=\"'+term+'\"]');\n\n            for(var j=0; j<termnodes.length;j++){\n                var attr = $(termnodes[j]).attr(\"data-past\");\n                if ( attr == \"true\" || attr == true  ) {\n                    var termnode = termnodes[j];\n                }\n            }\n\n            console.log(termnode);\n            createNode(termnode, nodes[i]);\n        }\n\n        $.when.apply($, nodes).done(function() {\n            // do things that need to wait until ALL gets are done\n            //register event handlers\n            initToggleNodes(\"mycoursespast\");\n        });\n    }\n\n     /**\n     * Fill in all future and current nodes\n     * @param {array} childNodes object array with all current and future\n     * @param {object array} node parent mycourses node\n     */\n    function fillCurrentNode(childNodes) {\n\n        //create an array for all nodes with an enddate to be moved into past section\n        var term =\"\";\n\n        for(var i=0; i<childNodes.length; i++){\n\n            if(term != childNodes[i].term ){\n                term = childNodes[i].term;\n            }\n            var termnodes = $('.list-group-item[data-key=\"'+term+'\"]');\n\n            for(var j=0; j<termnodes.length;j++){\n                var attr = $(termnodes[j]).attr(\"data-past\");\n                if (attr == \"false\") {\n                    var termnode = termnodes[j];\n                }\n            }\n            createNode(termnode, childNodes[i]);\n        }\n    }\n\n     /**\n     * Create header indicating term\n     * @param {string} term of next set of courses\n     */\n    function createNode(node,childNode) {\n        Templates.render('local_boostnavigation/mycoursesoveride', childNode).then(function(html) {\n            $(node).after(html);\n        });\n    }\n\n     /**\n     * Create header indicating term\n     * @param {string} term of next set of courses\n     */\n    function createHeaders(terms,node,past) {\n\n        console.log(\"Test1\");\n        var all = function(array){\n            var deferred = $.Deferred();\n            var fulfilled = 0, length = array.length;\n            var results = [];\n\n            if (length === 0) {\n                deferred.resolve(results);\n            } else {\n                array.forEach(function(promise, i){\n                    $.when(promise()).then(function(value) {\n                        results[i] = value;\n                        fulfilled++;\n                        if(fulfilled === length){\n                            deferred.resolve(results);\n                        }\n                    });\n                });\n            }\n\n            return deferred.promise();\n        };\n\n        console.log(\"Test2\");\n        console.log(terms);\n\n        var promises = [];\n\n\n        terms.forEach(function(term) {\n            var headerarray = {};\n            headerarray['header']='true';\n            headerarray['text']=term;\n            headerarray['parent_key']=\"mycourses\";\n            headerarray['get_indent']=1;\n\n            console.log(\"test2b\");\n            console.log(term);\n            var split = term.split(\" \");\n            if(split[0]==\"Spring/Summer\"){\n                headerarray[\"Spring\"]=\"true\";\n            }else{\n                headerarray[split[0]]=\"true\";\n            }\n\n            if(past){\n                headerarray['past']=\"true\";\n                headerarray['hidden']=1;\n                headerarray['get_indent']=2;\n            }\n\n            promises.push(function() {\n                return Templates.render('local_boostnavigation/mycoursesoveride', headerarray).then(function(html) {\n                    node.after(html);\n                }).promise();\n            });\n        });\n\n        console.log(\"Test3\");\n        return $.when(all(promises)).then(function(results) {\n            return results;\n        });\n    }\n\n    return {\n        init: function(currentNodes,cterms, pastNodes, pterms, ongoingNodes) {\n\n            var nodes = $('.list-group-item[data-parent-key=\"mycourses\"]');\n            nodes.remove();\n\n            var node = $('.list-group-item[data-key=\"mycourses\"]');\n\n            console.log(\"NODES0\");\n            console.log(pastNodes);\n\n            if(pastNodes.length >0){\n                createPastNode(node, sortByKeyDesc(pastNodes,\"term\",\"text\"),pterms);\n            }\n\n            createHeaders(cterms,node,false).then(function(){\n                fillCurrentNode(sortByKeyDesc(currentNodes, \"term\",\"text\"));\n            });\n\n            if(ongoingNodes.length >0){\n                createOngoingNode(node, sortByKeyDesc(ongoingNodes,\"text\"));\n            }\n        }\n    };\n});"],"file":"mycoursesoveride.min.js"}